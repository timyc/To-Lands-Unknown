bootbox.setDefaults({animate:!1});var autotimer,autorestart,fighting=0,gameName=document.title,autoing=0,am=0,funcheck=0,checkAuto="";function toCoin(e){var t="",n=Math.floor(e/1e6),o=Math.floor((e-1e6*n)/1e4),a=Math.floor((e-1e6*n-1e4*o)/100),l=e-1e6*n-1e4*o-100*a;return n>0&&(t='<span title="Salites" style="color:#4ec381">'+numeral(n).format("0,0")+'s</span> <span title="Velites" style="color:#ffcccb">'+o+'v</span> <span title="Calites" style="color:#e68916">'+a+'c</span> <span title="Emites" style="color:#9799ff">'+l+"e</span>"),0==n&&o>0&&(t='<span title="Velites" style="color:#ffcccb">'+o+'v</span> <span title="Calites" style="color:#e68916">'+a+'c</span> <span title="Emites" style="color:#9799ff">'+l+"e</span>"),0==n&&0==o&&a>0&&(t='<span title="Calites" style="color:#e68916">'+a+'c</span> <span title="Emites" style="color:#9799ff">'+l+"e</span>"),0==n&&0==o&&0==a&&(t='<span title="Emites" style="color:#9799ff">'+l+"e</span>"),t}function doCheckAuto(){$("#mainnav").val("1"),$("#content").html(checkAuto)}function auto(){0==autoing&&timertime<=0&&timer2time<=0&&(autoing=1,$.post("/auto",function(e){if(e>0){varstopauto=0,am=e;var t=$("#mob").val();if(""!=$("#mob option:selected").text()){var n=function(){funcheck=1,$.post("/battle",{t:am,mob:t},function(e){am--,document.getElementById("bb")&&(document.getElementById("bb").disabled=!0),document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!0),$(".moveBtn").attr("disabled",!0),clearTimeout(timertimeout),actionprogress=0;var t=e.split("[BREAK]");1==document.getElementById("mainnav").options[0].selected&&$("#content").html(t[0]),checkAuto=t[0],$("#level").html(numeral(t[1]).format("0,0")),$("#exp").html(t[2]),$("#gold").html(toCoin(t[3])),$("#credits").html(numeral(t[4]).format("0,0")),$("#mithril").html(numeral(t[5]).format("0,0")),$("#health").html(t[6]),$("#attack").html(t[7]),$("#defense").html(t[8]),$("#accuracy").html(t[9]),$("#evasion").html(t[10])}).always(function(e){document.title="("+am+") "+gameName,funcheck=0,am>0&&0==varstopauto?(autotimer=setTimeout(function(){n()},6e3),"[BREAK]moblist();"!=e&&(timer2(6e3),progressSlider(6e3)),document.getElementById("doingThing").innerHTML='<a href="javascript:doCheckAuto()">Autoing mob (click to check)</a>'):1==varstopauto||0==am?(varstopauto=0,timer2time=0,clearTimeout(autotimer),document.title=gameName,autoing=0,timer(6e3),progressSlider(6e3),document.getElementById("doingThing").innerHTML="Nothing"):document.getElementById("doingThing").innerHTML="Nothing"}).fail(function(e){varstopauto=0,timer2time=0,clearTimeout(autotimer),document.title=gameName,autoing=0,fighting=0,$("#content").html(e.responseText)})};n()}}}).fail(function(e){varstopauto=0,timer2time=0,clearTimeout(autotimer),document.title=gameName,autoing=0,fighting=0,$("#content").html(e.responseText)}))}function moveMap(e){$(".moveBtn").attr("disabled",!0),$.ajax({type:"POST",url:"/move",data:{x:e},success:function(e){document.getElementById("place").innerHTML=e,nav("battle"),setTimeout(function(){$(".moveBtn").attr("disabled",!1)},1050)},error:function(e){document.getElementById("place").innerHTML=e.responseText}})}function toPlace(e){$(".moveBtn").attr("disabled",!0),$.ajax({type:"POST",url:"/toPlace",data:{x:e},success:function(e){document.getElementById("place").innerHTML=e,nav("battle"),setTimeout(function(){$(".moveBtn").attr("disabled",!1)},1e3),$("body").css({"background-image":'url("img/backgrounds/'+document.getElementById("bgChange").innerHTML+'.jpg")'})},error:function(e){document.getElementById("place").innerHTML=e.responseText}})}function keyup(e){13==e?(sortchat(),document.getElementById("inputchat").style.color=document.getElementById("chatwindow").style.color):"/g"==document.getElementById("inputchat").value.substr(0,2)||"/c"==document.getElementById("inputchat").value.substr(0,2)?document.getElementById("inputchat").style.color="#33CC33":"/s"==document.getElementById("inputchat").value.substr(0,2)&&"/sp"!=document.getElementById("inputchat").value.substr(0,3)?document.getElementById("inputchat").style.color="#FF6666":"/p"==document.getElementById("inputchat").value.substr(0,2)?document.getElementById("inputchat").style.color="#6666CC":"/m"==document.getElementById("inputchat").value.substr(0,2)&&"/me"!=document.getElementById("inputchat").value.substr(0,3)?document.getElementById("inputchat").style.color="#FFAAAA":"/w "==document.getElementById("inputchat").value.substr(0,3)||"/v "==document.getElementById("inputchat").value.substr(0,3)||"/r "==document.getElementById("inputchat").value.substr(0,3)?document.getElementById("inputchat").style.color="#DD77DD":document.getElementById("inputchat").style.color=document.getElementById("chatwindow").style.color}var timeout2,timertimeout=0,varstopauto=0;function timer(e,t,n,o){timertime=e,500==e&&(document.title=gameName),document.getElementById("bb")&&(document.getElementById("bb").disabled=!0),document.getElementById("ab")&&(document.getElementById("ab").disabled=!0),document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!0),$(".moveBtn").attr("disabled",!0);var a=Math.ceil(e/1e3);document.getElementById("timer").innerHTML="Action Timer: "+a,e<=0?(timertimeout=0,document.getElementById("bb")&&(document.getElementById("bb").disabled=!1),document.getElementById("ab")&&(document.getElementById("ab").disabled=!1),document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!1),$(".moveBtn").attr("disabled",!1)):(e-=500,t&&(e=e+","+t+","+n+',"'+o+'"'),timertimeout=setTimeout("timer("+e+");",500))}function timer2(e){timer2time=e,500==e&&(document.title=gameName),document.getElementById("bb")&&(document.getElementById("bb").disabled=!0),$(".moveBtn").attr("disabled",!0);var t=Math.ceil(e/1e3);document.getElementById("timer").innerHTML="Action Timer: "+t,e<=0?(timer2time=0,timertimeout=0,document.getElementById("bb")&&(document.getElementById("bb").disabled=!1),$(".moveBtn").attr("disabled",!1)):(e-=500,timertimeout=setTimeout("timer2("+e+");",500))}function progressSlider(e){var t=document.getElementById("testTimer");t.offsetWidth,t.style.transition="none",t.style.width="100%",t.offsetWidth,t.style.transition="width "+e/1e3+"s linear",t.style.width="0%"}function stopauto(){0==varstopauto&&(varstopauto=1,autoing=0,am=0,clearTimeout(autotimer),clearInterval(autorestart),document.getElementById("stopauto").innerHTML="Stopping...",document.getElementById("doingThing").innerHTML="Nothing",$("#stopautoB").attr("disabled",!0))}function nav(e){"battle"==e?(document.getElementById("bb")&&(document.getElementById("bb").disabled=!0),document.getElementById("ab")&&(document.getElementById("ab").disabled=!0),document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!0),moblist(0),actionprogress=0):"settings"==e&&settings(0)}function settings(e){$.ajax({type:"POST",url:"/settings",data:{setting:e,newsetting:"none"},success:function(e){document.getElementById("content").innerHTML=e},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function verify(){$.ajax({type:"POST",url:"/verify",data:{response:$("#secQ").val()},success:function(e){nav("battle")}})}function replenish(){$.ajax({type:"POST",url:"/replenish",success:function(){varstopauto=1,autoing=0,am=0,clearTimeout(autotimer),clearInterval(autorestart),nav("battle")},error:function(e){varstopauto=1,autoing=0,am=0,clearTimeout(autotimer),clearInterval(autorestart),$("#content").html(e.responseText)}})}function switchToGuildNav(){$("#mainnav").val("4")}function switchToInventoryNav(){$("#mainnav").val("5")}function switchToStoryNav(){$("#mainnav").val("3")}function guildpage(e,t,n){2==e&&(t=document.getElementById("guildname").value),14==e&&(t=document.getElementById("gMOTD").value),15==e&&(t=document.getElementById("inviteUser").value),$.ajax({type:"POST",url:"/guilds",data:{x:e,y:t,z:n},success:function(t){if(2==e){var n=t.split("[BREAK]");$("#content").html(n[0]),$("#gold").html(n[1]),$("#gName").html(n[2])}document.getElementById("content").innerHTML=t},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function teleportpage(){$.ajax({type:"POST",url:"/teleporter",success:function(e){document.getElementById("content").innerHTML=e},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function chatinput(e,t,n){$.ajax({type:"POST",url:"/input",data:{message:e,arg:t,arg2:n},success:function(e){addChatLines(e.split("[BREAK]"))}})}function openpage(e,t,n){1==e&&(arg="online"),2==e&&(arg="rankings"),3==e&&(arg="updates"),4==e&&(arg="rules"),5==e&&(arg="commands"),6==e&&(arg="purchase"),7==e&&(arg="shop"),8==e&&(arg="ranks"),9==e&&(arg="faq"),10==e&&(arg="redeem"),11==e&&(arg="mail"),12==e&&(arg="market"),13==e&&(arg="referral"),14==e&&(arg="online"),$.ajax({type:"POST",url:"/popup",data:{x:arg,y:t,z:n},success:function(e){var t=e.split("[BREAK]");$("#popup").html(t[0]),document.getElementById("popupholder").style.visibility="visible"},error:function(e){document.getElementById("popup").innerHTML=e.responseText,document.getElementById("popupholder").style.visibility="visible"}})}function whisper(e){closepage(),document.getElementById("inputchat").value="/w "+e+" ",document.getElementById("inputchat").focus(),document.getElementById("inputchat").style.color="#DD77DD"}function commands(e,t){$.ajax({type:"POST",url:"/commands",data:{x:e.replace(/&/,"%26"),y:t},success:function(t){"inventoryCount"==e?bootbox.alert(t):addChatLines(t.split("[BREAK]"))},error:function(e){addChatLines(e.split("[BREAK]"))}})}function sortchat(){if(""!=document.getElementById("inputchat").value&&" "!=document.getElementById("inputchat").value){var e=document.getElementById("inputchat").value;document.getElementById("inputchat").value=""," "==(e=(e=e.replace(/</g,"&lt;")).replace(/>/g,"&gt;"))[0]&&(e=e.replace(" ",""));var t=e.split(" ");if("/w"==t[0].toLowerCase()){if(t[1]){t[0]="";var n="w";chatinput(e=t.join(" "),n)}}else if("/g"==t[0].toLowerCase()||"/c"==t[0].toLowerCase()||"/guild"==t[0].toLowerCase()){if(t[1]){t[0]="";n="guild";chatinput(e=t.join(" "),n)}}else if("/s"==t[0].toLowerCase()){if(t[1]){t[0]="";n="staff";chatinput(e=t.join(" "),n)}}else if("/m"==t[0].toLowerCase()){if(t[1]){t[0]="";n="market";chatinput(e=t.join(" "),n)}}else if("/p"==t[0].toLowerCase()){if(t[1]){t[0]="";n="pub";chatinput(e=t.join(" "),n)}}else if("/me"==t[0].toLowerCase()){if(t[1]){t[0]="";n="me";chatinput(e=t.join(" "),n)}}else if("/ban"==t[0].toLowerCase()){if(t[1]){t[0]="";n="ban";e=t.join(" "),commands(n,t[1])}}else if("/mute"==t[0].toLowerCase()){if(t[1]){t[0]="";n="mute";e=t.join(" "),commands(n,t[1])}}else if("/unmute"==t[0].toLowerCase()){if(t[1]){t[0]="";n="unmute";e=t.join(" "),commands(n,t[1])}}else if("/kick"==t[0].toLowerCase()){if(t[1]){t[0]="";n="kick";e=t.join(" "),commands(n,t[1])}}else if("/"==t[0].substr(0,1)){n=t[0].slice(1);t.shift(),e=t.join(" "),commands(n)}else n="",chatinput(e=t.join(" "),n)}}function closepage(){document.getElementById("popupholder").style.visibility="hidden",document.getElementById("popupresponse").innerHTML=""}function equip(e){$.ajax({type:"POST",url:"/equip",data:{equip:e},success:function(t){document.getElementById("equipstuff").innerHTML=t;$("p").removeClass("highlight"),$(".equipment"+e).addClass("highlight")},error:function(e){document.getElementById("equipstuff").innerHTML=e.responseText}})}function equipupgrade(e){$.ajax({type:"POST",url:"/equip",data:{upgrade:e},success:function(t){var n=t.split("[BREAK]");$("#equipstuff").html(n[0]),$("#gold").html(toCoin(n[1])),1==e&&$("#equip1").html(n[2]),2==e&&$("#equip2").html(n[2]),3==e&&$("#equip3").html(n[2]),4==e&&$("#equip4").html(n[2]),5==e&&$("#equip5").html(n[2]),6==e&&$("#equip6").html(n[2]),7==e&&$("#equip7").html(n[2]),8==e&&$("#equip8").html(n[2]),9==e&&$("#equip9").html(n[2])},error:function(e){document.getElementById("equipstuff").innerHTML=e.responseText}})}function quest(e,t){$.ajax({type:"POST",url:"/quest",data:{x:e,y:t},success:function(t){if(document.getElementById("popupholder").style.visibility="visible",0==e&&$("#popup").html(t),1==e){var n=t.split("[BREAK]");$("#popup").html(n[0]),$("#gold").html(toCoin(n[1])),$("#mithril").html(numeral(n[2]).format("0,0")),$("#qNum").html(numeral(n[3]).format("0,0")),$("#qInfo").html(n[4])}if(2==e||3==e){n=t.split("[BREAK]");$("#popup").html(n[0]),$("#qInfo").html(n[1])}},error:function(e){alert("Request timed out. Please try again. If problem persist, try refreshing.")}})}function buy(e,t){1==e&&(t=document.getElementById("minutesToBuy").value),20==e&&(t=document.getElementById("ranklist").value),$.ajax({type:"POST",url:"/purchase",data:{x:e,thing:t},success:function(t){document.getElementById("popupholder").style.visibility="visible";var n=t.split("[BREAK]");"status1"==n[0]&&(openpage(8),$("#repRank").html(n[1])),1==e&&(bootbox.alert(n[0]),openpage(6,2),$("#credits").html(numeral(n[1]).format("0,0"))),2!=e&&3!=e&&4!=e&&5!=e&&7!=e&&8!=e||(bootbox.alert(n[0]),openpage(6,3),$("#credits").html(numeral(n[1]).format("0,0"))),6==e&&(bootbox.alert(n[0]),openpage(6,4),$("#credits").html(numeral(n[1]).format("0,0"))),21==e&&(bootbox.alert(n[0]),$("#gold").html(toCoin(n[1])),$("#credits").html(numeral(n[2]).format("0,0")))},error:function(t){21==e?bootbox.alert("Do you have enough items?"):bootbox.alert("Error.")}})}function profile(e,t,n){$.ajax({type:"POST",url:"/profile",data:{x:e,y:t,z:n},success:function(e){document.getElementById("popupholder").style.visibility="visible",document.getElementById("popup").innerHTML=e},error:function(e){alert("Request timed out. Please try again. If problem persist, try refreshing.")}})}function mail(e,t,n,o,a){1==e&&(t=document.getElementById("toUser").value,n=document.getElementById("toTitle").value,o=document.getElementById("toMessage").value,a=document.getElementById("toGold").value),$.ajax({type:"POST",url:"/mail",data:{x:e,y:t,z:n,w:o,v:a},success:function(e){var t=e.split("[BREAK]");bootbox.alert('<span class="font-weight-bold">'+t[0]+"</span>"),$("#gold").html(toCoin(t[1])),openpage(11,1)},error:function(e){alert("Request timed out. Please try again. If problem persist, try refreshing.")}})}function closeequip(){$("p").removeClass("highlight"),document.getElementById("equipstuff").innerHTML="No equipment selected."}function inventory(e,t,n){2==t?bootbox.confirm({size:"small",message:"Are you sure you want to delete this item?",callback:function(o){0!=o&&$.ajax({type:"POST",url:"/inventory",data:{x:e,y:t,z:n},success:function(o){var a=o.split("[BREAK]");(0==e&&0==n||e>0&&1==t&&0==n||e>0&&2==t)&&($("#content").html(a[0]),$("#health").html(a[1]),$("#attack").html(a[2]),$("#defense").html(a[3]),$("#accuracy").html(a[4]),$("#evasion").html(a[5]))},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}}):$.ajax({type:"POST",url:"/inventory",data:{x:e,y:t,z:n},success:function(e){var t=e.split("[BREAK]");$("#content").html(t[0]),$("#health").html(t[1]),$("#attack").html(t[2]),$("#defense").html(t[3]),$("#accuracy").html(t[4]),$("#evasion").html(t[5])},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function story(e){$.ajax({type:"POST",url:"/story",data:{x:e},success:function(e){var t=e.split("[BREAK]");$("#content").html(t[0]),$("#gold").html(toCoin(t[1])),$("#credits").html(numeral(t[2]).format("0,0")),$("#mithril").html(numeral(t[3]).format("0,0")),setTimeout(function(){document.getElementById("mainnav").focus()},200)},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function teleportBeast(){bootbox.confirm({size:"small",message:"Are you sure you want to teleport to the nearest beast for 1,500,000 gold?",callback:function(e){0!=e&&$.ajax({type:"POST",url:"/teleportBeast",success:function(e){var t=e.split("[BREAK]");bootbox.alert('<span class="font-weight-bold">'+t[0]+"</span>"),$("#gold").html(toCoin(t[1])),moveMap(),nav("battle"),varstopauto=0,timer2time=0,clearTimeout(autotimer),document.title=gameName,autoing=0,fighting=0,setTimeout(function(){$("body").css({"background-image":'url("img/backgrounds/'+document.getElementById("bgChange").innerHTML+'.jpg")'})},500)},error:function(e){bootbox.alert('<span class="text-danger font-weight-bold">'+e.responseText+"</span>")}})}})}function teleport(){bootbox.confirm({size:"small",message:"Are you sure you want to teleport for 1,000,000 gold?",callback:function(e){0!=e&&$.ajax({type:"POST",url:"/teleportLoc",data:{x:$("#teleportList").val()},success:function(e){var t=e.split("[BREAK]");bootbox.alert('<span class="font-weight-bold">'+t[0]+"</span>"),$("#gold").html(toCoin(t[1])),moveMap(),nav("battle"),varstopauto=0,timer2time=0,clearTimeout(autotimer),document.title=gameName,autoing=0,fighting=0,setTimeout(function(){$("body").css({"background-image":'url("img/backgrounds/'+document.getElementById("bgChange").innerHTML+'.jpg")'})},500)},error:function(e){bootbox.alert('<span class="text-danger font-weight-bold">'+e.responseText+"</span>")}})}})}function marketbuy(e,t,n){if(1==e)var o="Are you sure you want to purchase this?";else if(2==e)o="Click OK to confirm.";else if(3==e)o="Click OK to confirm.";else o="Are you sure you want to list this?";bootbox.confirm({size:"small",message:o,callback:function(o){0!=o&&(4==e&&(t=document.getElementById("creditsToSell").value,n=document.getElementById("creditsSellPrice").value),$.ajax({type:"POST",url:"/market",data:{x:e,y:t,z:n},success:function(t){var n=t.split("[BREAK]");bootbox.alert('<span class="font-weight-bold">'+n[0]+"</span>"),$("#gold").html(toCoin(n[1])),$("#credits").html(numeral(n[2]).format("0,0")),1==e?setTimeout(function(){openpage(12,1,0)},500):2==e?setTimeout(function(){openpage(12,2,0)},500):3==e?setTimeout(function(){openpage(12,3,0)},500):setTimeout(function(){openpage(12,4)},500)},error:function(e){bootbox.alert('<span class="text-danger font-weight-bold">'+e.responseText+"</span>")}}))}})}function mithrilupgrades(e){$.ajax({type:"POST",url:"/mithrilupgrades",data:{x:e},success:function(e){var t=e.split("[BREAK]");$("#content").html(t[0]),$("#mithril").html(numeral(t[1]).format("0,0")),setTimeout(function(){document.getElementById("mainnav").focus()},200)},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function milestones(e,t){$.ajax({type:"POST",url:"/milestones",data:{x:e,y:t},success:function(e){var t=e.split("[BREAK]");$("#content").html(t[0]),$("#gold").html(toCoin(t[1])),$("#credits").html(numeral(t[2]).format("0,0")),$("#mithril").html(numeral(t[3]).format("0,0")),setTimeout(function(){document.getElementById("mainnav").focus()},200)},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function moblist(e){varstopauto=0,autoing=0,document.getElementById("mainnav").options[0].selected=!0,$.ajax({type:"POST",url:"/moblist",data:{x:e},success:function(e){document.getElementById("content").innerHTML=e,localStorage.getItem("npbbg_lastMon")&&0!==$("#mob option[value='"+localStorage.getItem("npbbg_lastMon")+"']").length&&$("#mob option[value='"+localStorage.getItem("npbbg_lastMon")+"']").prop("selected",!0),timer(1e3),progressSlider(1e3)},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function changePass(){if(""==document.getElementById("newpass").value||document.getElementById("newpass").value!=document.getElementById("newpassconfirm").value)return bootbox.alert('<span class="text-danger font-weight-bold">Passwords do not match!</span>');$.ajax({type:"POST",url:"/passwordUpdate",data:{password:document.getElementById("newpass").value},success:function(e){bootbox.alert(e),document.getElementById("newpass").value="",document.getElementById("newpassconfirm").value=""},error:function(e){bootbox.alert(e.responseText),document.getElementById("newpass").value="",document.getElementById("newpassconfirm").value=""}})}function redeemCode(){$.ajax({type:"POST",url:"/redeem",data:{x:document.getElementById("redeem").value},success:function(e){var t=e.split("[BREAK]");document.getElementById("redeem").value="",document.getElementById("redeemResponse").innerHTML=t[0],$("#gold").html(toCoin(t[1])),$("#credits").html(numeral(t[2]).format("0,0")),$("#mithril").html(numeral(t[3]).format("0,0"))},error:function(e){document.getElementById("redeem").value="",document.getElementById("redeemResponse").innerHTML=e.responseText}})}function guildDonate(e){var t;t=1==e?document.getElementById("donateGold").value:2==e?document.getElementById("donateCredits").value:3==e?document.getElementById("donateMithril").value:4==e?document.getElementById("donateTimber").value:document.getElementById("donateStones").value,$.ajax({type:"POST",url:"/guilds",data:{x:7,y:e,z:t},success:function(e){var t=e.split("[BREAK]");document.getElementById("content").innerHTML=t[0],$("#gold").html(toCoin(t[1])),$("#credits").html(numeral(t[2]).format("0,0")),$("#mithril").html(numeral(t[3]).format("0,0")),$("#timber").html(numeral(t[4]).format("0,0")),$("#stones").html(numeral(t[5]).format("0,0"))},error:function(e){document.getElementById("content").innerHTML=e.responseText}})}function userStuffChange(e){1==(e=document.getElementById("userSelect").value)&&(document.getElementById("option1").style.display="block",document.getElementById("option2").style.display="none",document.getElementById("option3").style.display="none"),2==e&&(document.getElementById("option2").style.display="block",document.getElementById("option1").style.display="none",document.getElementById("option3").style.display="none"),3==e&&(document.getElementById("option3").style.display="block",document.getElementById("option1").style.display="none",document.getElementById("option2").style.display="none")}function online(){$.post("/commands",{x:"online"},function(e){var t=e;$("#onlinecount").html(t)}),$("#poDesc").popover({trigger:"hover"})}timertime=0,timer2time=0,$(document).on("submit","#avatarForm",function(e){return e.preventDefault(),""==document.getElementById("avatarToUpload").value?bootbox.alert("Cannot upload empty avatar"):document.getElementById("avatarToUpload").files[0].size>1e6?bootbox.alert("Avatar size was greater than 1MB! Choose something smaller!"):($.ajax({url:"/uploadAvatar",type:"post",data:new FormData($("#avatarForm").get(0)),processData:!1,contentType:!1,success:function(e){bootbox.alert(e),document.getElementById("avatarToUpload").value=""},error:function(e){bootbox.alert(e.responseText),document.getElementById("avatarToUpload").value=""}}),!1)});var actionprogress=0;function battle(e,t,n,o){document.getElementById("bb")&&(document.getElementById("bb").disabled=!0,document.getElementById("bb").value="Wait..."),document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!0,document.getElementById("bb2").value="Wait..."),document.getElementById("ab")&&(document.getElementById("ab").disabled=!0,document.getElementById("ab").value="Wait...");n=$("#mob").val(),$("#mob option:selected").text();0==fighting&&(fighting=1,lastMonS(),$.ajax({type:"POST",url:"/battle",data:{t:0,mob:n},success:function(e){document.getElementById("bb")&&(document.getElementById("bb").disabled=!0),fighting=0,document.getElementById("mainnav").options[0].selected=!0,document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!0),$(".moveBtn").attr("disabled",!0),timer2(2e3),progressSlider(2e3),actionprogress=0;var t=e.split("[BREAK]");$("#content").html(t[0]),$("#level").html(numeral(t[1]).format("0,0")),$("#exp").html(t[2]),$("#gold").html(toCoin(t[3])),$("#credits").html(numeral(t[4]).format("0,0")),$("#mithril").html(numeral(t[5]).format("0,0")),$("#health").html(t[6]),$("#attack").html(t[7]),$("#defense").html(t[8]),$("#accuracy").html(t[9]),$("#evasion").html(t[10])},error:function(e){fighting=0,$("#content").html(e.responseText)}}))}function battleBeast(e,t,n,o){n=$("#beast").val(),o=$("#beast option:selected").text();0==fighting&&(fighting=1,$.ajax({type:"POST",url:"/battleBeast",data:{t:0,check:t,beast:n,beastname:o},success:function(e){fighting=0,document.getElementById("mainnav").options[0].selected=!0,document.getElementById("bb")&&(document.getElementById("bb").disabled=!0),document.getElementById("bb2")&&(document.getElementById("bb2").disabled=!0),$(".moveBtn").attr("disabled",!0),timer2(2e3),progressSlider(2e3),actionprogress=0;var t=e.split("[BREAK]");$("#content").html(t[0]),$("#gold").html(toCoin(t[1])),$("#credits").html(numeral(t[2]).format("0,0")),$("#mithril").html(numeral(t[3]).format("0,0")),$("#timber").html(numeral(t[4]).format("0,0")),$("#stones").html(numeral(t[5]).format("0,0"))}}))}function lastMonS(){localStorage.setItem("npbbg_lastMon",$("#mob").val())}function mainnav(){performnav(document.getElementById("mainnav").value)}function performnav(e){document.getElementById("mainnav").value=e,1==e&&(closepage(),nav("battle")),2==e&&quest(0,0),3==e&&story(0),4==e&&guildpage(0),5==e&&inventory(0,0,0),6==e&&teleportpage(),7==e&&mithrilupgrades(0),8==e&&milestones(1),11==e&&nav("settings")}function addChatLines(e){if(Array.isArray(e)){e.reverse();for(var t=0;t<e.length;++t)""!=e[t]&&$("#chatwindow").prepend(e[t])}else $("#chatwindow").prepend(e);$("#chatwindow").children(":nth-child(n+23)").remove()}function chatWindow(){$("#chatwindow").load("/chat")}function chat(e){$.post("/chat",{arg:e},function(e){addChatLines(e.split("[BREAK]"))}).always(function(){chattimer=setTimeout(chat,2e3)})}function startchat(){chat("start")}document.addEventListener("DOMContentLoaded",function(e){e.stopPropagation()},!1),window.addEventListener=null;